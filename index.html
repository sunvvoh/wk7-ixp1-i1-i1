<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taco Shop - Narrative 1</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f5e6d3;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        #money-counter {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 32px;
            font-weight: bold;
            color: #2d5016;
            background-color: #fff;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1000;
        }

        #game-container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        #speech-bubble {
            position: absolute;
            top: 15%;
            background-color: white;
            padding: 20px 30px;
            border-radius: 20px;
            border: 3px solid #333;
            font-size: 24px;
            max-width: 600px;
            text-align: center;
            display: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        #cat-sprite {
            width: 300px;
            height: 300px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            transition: all 0.3s ease;
        }

        #input-container {
            position: absolute;
            bottom: 20%;
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        #order-input {
            font-size: 20px;
            padding: 15px 20px;
            width: 400px;
            border: 3px solid #333;
            border-radius: 10px;
            text-align: center;
        }

        #submit-button {
            font-size: 20px;
            padding: 15px 40px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        #submit-button:hover {
            background-color: #45a049;
        }

        #ingredients-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
            flex-direction: row;
            gap: 30px;
            align-items: center;
        }

        .ingredient-option {
            width: 150px;
            height: 150px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            cursor: grab;
            transition: transform 0.2s, filter 0.2s;
        }

        .ingredient-option:hover {
            transform: scale(1.1);
            filter: brightness(1.2);
        }

        .ingredient-option:active {
            cursor: grabbing;
        }

        #tortilla {
            position: absolute;
            bottom: 15%;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            height: 200px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            display: none;
            border: 3px dashed transparent;
            border-radius: 50%;
            transition: border-color 0.3s;
        }

        #tortilla.drag-over {
            border-color: #4CAF50;
        }

        .placed-ingredient {
            position: absolute;
            width: 120px;
            height: 120px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            pointer-events: none;
        }

        #final-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            font-weight: bold;
            color: #2d5016;
            text-align: center;
            display: none;
            background-color: rgba(255, 255, 255, 0.95);
            padding: 50px 80px;
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .slide-out-left {
            animation: slideOutLeft 1s forwards;
        }

        @keyframes slideOutLeft {
            to {
                transform: translateX(-150%);
                opacity: 0;
            }
        }

        .fade-in {
            animation: fadeIn 0.5s forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div id="money-counter">$0.00</div>

    <div id="game-container">
        <div id="speech-bubble"></div>
        <div id="cat-sprite"></div>

        <div id="input-container">
            <input type="text" id="order-input" placeholder="Type the order here...">
            <button id="submit-button">Submit Order</button>
        </div>

        <div id="ingredients-container"></div>
        <div id="tortilla"></div>
        <div id="final-message"></div>
    </div>

    <script>
        // Game State
        let totalMoney = 0;
        let currentRound = 0;
        let correctnessValue = 0;
        let currentOrder = {};
        let currentPhase = 'ordering'; // ordering, protein, vegetable, sauce
        let selectedIngredient = null;

        // Game Data
        const proteins = ['beef', 'pork', 'chicken'];
        const vegetables = ['cilantro', 'onions'];
        const sauces = ['salsa verde', 'salsa roja'];

        const catExpressions = {
            '-2': 'assets/cat saddest.png',
            '-1': 'assets/cat sad.png',
            '0': 'assets/cat neutral.png',
            '1': 'assets/cat happy.png',
            '2': 'assets/cat happiest.png',
            'talking': 'assets/cat talking.png'
        };

        const ingredientImages = {
            'beef': 'assets/beef.png',
            'pork': 'assets/pork.png',
            'chicken': 'assets/chicken.png',
            'cilantro': 'assets/cilantro.png',
            'onions': 'assets/onions.png',
            'salsa verde': 'assets/salsa verde.png',
            'salsa roja': 'assets/salsa roja.png',
            'tortilla': 'assets/tortilla.png'
        };

        // DOM Elements
        const catSprite = document.getElementById('cat-sprite');
        const speechBubble = document.getElementById('speech-bubble');
        const inputContainer = document.getElementById('input-container');
        const orderInput = document.getElementById('order-input');
        const submitButton = document.getElementById('submit-button');
        const ingredientsContainer = document.getElementById('ingredients-container');
        const tortilla = document.getElementById('tortilla');
        const moneyCounter = document.getElementById('money-counter');
        const finalMessage = document.getElementById('final-message');

        // Initialize Game
        function startGame() {
            currentRound = 0;
            totalMoney = 0;
            updateMoneyDisplay();
            startNewRound();
        }

        function startNewRound() {
            currentRound++;
            correctnessValue = 0;
            currentPhase = 'ordering';

            // Reset UI
            speechBubble.style.display = 'none';
            inputContainer.style.display = 'none';
            ingredientsContainer.style.display = 'none';
            tortilla.style.display = 'none';
            orderInput.value = '';

            // Clear any placed ingredients
            document.querySelectorAll('.placed-ingredient').forEach(el => el.remove());

            // Generate random order
            currentOrder = {
                protein: proteins[Math.floor(Math.random() * proteins.length)],
                vegetable: vegetables[Math.floor(Math.random() * vegetables.length)],
                sauce: sauces[Math.floor(Math.random() * sauces.length)]
            };

            // Show cat and start typing
            updateCatExpression(0);
            setTimeout(() => {
                typeOrderText();
            }, 500);
        }

        function updateCatExpression(value) {
            catSprite.style.backgroundImage = `url('${catExpressions[value.toString()]}')`;
        }

        function typeOrderText() {
            const orderText = `I want the ${currentOrder.protein}, ${currentOrder.vegetable}, and ${currentOrder.sauce} taco`;
            catSprite.style.backgroundImage = `url('${catExpressions.talking}')`;
            speechBubble.style.display = 'block';
            speechBubble.textContent = '';

            let index = 0;
            const typingInterval = setInterval(() => {
                if (index < orderText.length) {
                    speechBubble.textContent += orderText[index];
                    index++;
                } else {
                    clearInterval(typingInterval);
                    setTimeout(() => {
                        updateCatExpression(0);
                        showInputBox();
                    }, 2000);
                }
            }, 50);
        }

        function showInputBox() {
            speechBubble.style.display = 'none';
            inputContainer.style.display = 'flex';
        }

        submitButton.addEventListener('click', checkOrder);
        orderInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') checkOrder();
        });

        function checkOrder() {
            const userInput = orderInput.value.toLowerCase().trim();
            const correctOrder = `${currentOrder.protein} ${currentOrder.vegetable} ${currentOrder.sauce} taco`;

            if (userInput === correctOrder) {
                inputContainer.style.display = 'none';
                startIngredientPhase('protein');
            } else {
                // Show order again
                orderInput.value = '';
                typeOrderText();
            }
        }

        function startIngredientPhase(phase) {
            currentPhase = phase;
            ingredientsContainer.innerHTML = '';
            ingredientsContainer.style.display = 'flex';
            tortilla.style.display = 'block';
            tortilla.style.backgroundImage = `url('${ingredientImages.tortilla}')`;

            let options = [];
            if (phase === 'protein') options = proteins;
            else if (phase === 'vegetable') options = vegetables;
            else if (phase === 'sauce') options = sauces;

            options.forEach(option => {
                const ingredientDiv = document.createElement('div');
                ingredientDiv.className = 'ingredient-option';
                ingredientDiv.style.backgroundImage = `url('${ingredientImages[option]}')`;
                ingredientDiv.draggable = true;
                ingredientDiv.dataset.ingredient = option;

                ingredientDiv.addEventListener('dragstart', handleDragStart);
                ingredientsContainer.appendChild(ingredientDiv);
            });
        }

        function handleDragStart(e) {
            selectedIngredient = e.target.dataset.ingredient;
            e.dataTransfer.effectAllowed = 'move';
        }

        tortilla.addEventListener('dragover', (e) => {
            e.preventDefault();
            tortilla.classList.add('drag-over');
        });

        tortilla.addEventListener('dragleave', () => {
            tortilla.classList.remove('drag-over');
        });

        tortilla.addEventListener('drop', (e) => {
            e.preventDefault();
            tortilla.classList.remove('drag-over');

            if (selectedIngredient) {
                handleIngredientSelection(selectedIngredient);
            }
        });

        function handleIngredientSelection(ingredient) {
            // Check if correct
            const isCorrect = ingredient === currentOrder[currentPhase];

            if (isCorrect) {
                correctnessValue++;
            } else {
                correctnessValue--;
            }

            // Clamp between -2 and 2
            correctnessValue = Math.max(-2, Math.min(2, correctnessValue));

            // Update cat expression
            updateCatExpression(correctnessValue);

            // Place ingredient on tortilla
            const placedIngredient = document.createElement('div');
            placedIngredient.className = 'placed-ingredient';
            placedIngredient.style.backgroundImage = `url('${ingredientImages[ingredient]}')`;
            placedIngredient.style.bottom = '15%';
            placedIngredient.style.left = '50%';
            placedIngredient.style.transform = 'translateX(-50%)';
            document.getElementById('game-container').appendChild(placedIngredient);

            // Hide current ingredients
            ingredientsContainer.style.display = 'none';

            // Move to next phase
            setTimeout(() => {
                if (currentPhase === 'protein') {
                    startIngredientPhase('vegetable');
                } else if (currentPhase === 'vegetable') {
                    startIngredientPhase('sauce');
                } else if (currentPhase === 'sauce') {
                    finishRound();
                }
            }, 1000);
        }

        function finishRound() {
            // Calculate money earned
            let moneyEarned = 0;
            if (correctnessValue === 2) {
                moneyEarned = Math.random() * 4 + 6; // $6-$10
            } else if (correctnessValue === 1) {
                moneyEarned = Math.random() * 3 + 3; // $3-$6
            } else if (correctnessValue === 0) {
                moneyEarned = Math.random() * 2 + 1; // $1-$3
            } else if (correctnessValue === -1) {
                moneyEarned = Math.random() * 0.9 + 0.1; // $0.10-$1
            } else if (correctnessValue === -2) {
                moneyEarned = 0; // $0
            }

            totalMoney += moneyEarned;
            updateMoneyDisplay();

            // Animate cat and taco leaving
            setTimeout(() => {
                catSprite.classList.add('slide-out-left');
                tortilla.classList.add('slide-out-left');
                document.querySelectorAll('.placed-ingredient').forEach(el => {
                    el.classList.add('slide-out-left');
                });

                setTimeout(() => {
                    catSprite.classList.remove('slide-out-left');
                    tortilla.classList.remove('slide-out-left');

                    if (currentRound < 4) {
                        startNewRound();
                    } else {
                        showFinalResult();
                    }
                }, 1000);
            }, 1500);
        }

        function updateMoneyDisplay() {
            moneyCounter.textContent = `$${totalMoney.toFixed(2)}`;
        }

        function showFinalResult() {
            ingredientsContainer.style.display = 'none';
            tortilla.style.display = 'none';
            catSprite.style.display = 'none';

            if (totalMoney >= 20) {
                finalMessage.textContent = 'you were able to pay rent! good job!';
            } else {
                finalMessage.textContent = "you couldn't pay rent... oh no...";
            }

            finalMessage.style.display = 'block';
            finalMessage.classList.add('fade-in');
        }

        // Start the game
        startGame();
    </script>
</body>
</html>
